# Контрольная работа 1

### Краткое описание задачи

Написать приложение, которое будет вести реестр автомобилей и предоставлять гибкий поиск этих авто.
Приложение должно позволить инициализировать таблицу автомобилей из csv, находящегося в ресурсах. 

Ниже будут описаны основные требования к приложению, а так же расписаны функции.
Функциями считать http-методы рест-контроллеров. Требования к каждому методу ниже описаны в виде
спецификации (с примерами тела запроса и тела ответа) и описания того, как метод должен отработать.

### Требования к приложению

1. Проект должен располагаться в корне git-репозитория
2. Вся работа с git только в ветке master
3. Технологический стек
   1. JDK 11
   2. Spring Boot 2.6.4 (web и data jpa)
   3. Lombok
   4. Flyway для миграций БД
   5. Apache Maven
   6. PostgreSQL. Важно: юзер, пароль и имя бд должны быть такими: test_java_22_1
4. JPA-сущность (@Entity): Производитель, список полей
   1. Идентификатор (строка)
   2. Наименование (строка)
   3. Машины (one-to-many на Машина)
5. JPA-сущность (@Entity): Машина, список полей
   1. Идентификатор (строка)
   2. Модель (строка)
   4. Год выпуска (число)
   5. Производитель (many-to-one на Производитель)
6. Миграционный sql для flyway, создающий таблицы Машин и Производителей
7. Сервисные классы (@Service) и jpa-репозитории для выше указанных сущностей
8. Контроллеры и необходимые DTO объекты для Машин и для Производителей
9. Конвертеры dto-entity


### Требования к функциям

1. Метод получения Производителя по идентификатору
   ```
   GET /manufacturer/{id}
   # пример тела ответа
   {
       "id": "string",
       "name": "string",
       "cars": [
           {
               "id": "string",
               "carModel": "string",
               "releaseYear": 2001
           },
           ...
       ]
   }
   ```
   
2. Метод создания нового Производителя
   ```
   POST /manufacturer
   # тело запроса
   {
       "name": "string"
   }
   # тело ответа
   {
       "id": "string",
       "name": "string"
   }
   ```
   В случае, если передан уже существующий в базе name, выкинуть исключение. Так же должна быть валидация на пустые значения
   
3. Метод получения Машины по идентификатору
   ```
   GET /cars/{id}
   # пример тела ответа
   {
       "id": "string",
       "carModel": "string",
       "releaseYear": 2001,
       "manufacturer": "string" // идентификатор
   }
   ```

4. Метод создания новой Машины
   ```
   POST /cars
   # тело запроса
   {
       "carModel": "string",
       "releaseYear": 2001,
       "manufacturer": "string" // идентификатор
   }
   # тело ответа
   {
       "id": "string",
       "carModel": "string",
       "releaseYear": 2001,
       "manufacturer": "string" // идентификатор
   }
   ```
   Должна присутствовать валидация на пустые значения.

5. Реализовать метод инициализации данных приложения  
   ```
   POST /cars/init
   ```  
   По вызову данного метода:
   1. Очистить таблицы с Машинами и Производителями, т.е. удалить все записи из таблиц (удалять, например, через deleteAll в репозитории)
   2. Импортировать файлы [cars.csv](src/main/resources/cars.csv) и [manufacturers.csv](src/main/resources/manufacturers.csv) в таблицу Машин. Файл может располагаться в ресурсах приложения
   3. При любом кол-ве вызовов инициализировать БД заново и не дублировать данные
   4. Если при импорте происходит ошибка на любом этапе, ни одна запись не должна сохраниться в бд
   
   Примечание: указанные файлы csv могут быть дополнены новыми колонками, если эти колонки понадобятся для какой-либо
   функциональности.  
   Имена производителей в csv считаются уникальными.

6. Реализовать метод поиска по произвольному набору полей
   ```
   POST /cars/fetch
   # тело запроса
   {
       "filters": {
           "carModel": "string",
           "releaseYear": 2016,
           ...
       }
   }
   # тело ответа
   [
       {
           "id": "string",
           "carModel": "string",
           "releaseYear": 2001,
           "manufacturer": "string",
       },
       ...
   ]
   ```
   В теле запроса filters перечисляются поля для фильтрации. Идентификатор в фильтрации не участвует;  
   Поиск по текстовым полям должен осуществляться по фрагменту слова (например, по "ан" может быть найдено слово "Иван")  
   По численным полям фильтрация должна осуществляться полным сравнением значения (без фрагментов)  
   При передаче неизвестных имён полей выбрасывать исключения    


### Система оценивания

При оценивании задания группа преподавателей будет использовать расшифровку, предоставленную ниже.
За каждый аспект оценивания вы можете получить от 0 до 100%, далее берётся вес аспекта.  
После проведение контрольной вы можете самостоятельно прикинуть свою примерную оценку, исходя их того, что при полном
соответствии условию аспекта вы получаете 100%, а иначе меньше (может быть как 0, так и какая-то доля за старания и
частичный результат).

| № | Наименоване | Вес |
| --- | --- | --- |
| 1 | Приложение собирается | 0,3 |
| 2 | Приложение запускается | 0,3 |
| 3 | Миграция работает (ddl-auto: validate) | 0,5 |
| 4 | Подключена БД по требованиям (имя бд, юзер, пароль) | 0,1 |
| 5 | Во всех методах при модификации данных используются транзакции | 0,5 |
| 6 | Для получения данных (без записи) используется рид-онли транзакция | 0,3 |
| 7 | POST-метод создания производителя | 0,5 |
| 8 | GET-метод получения производителя по id (вместе с машинами) | 0,8 |
| 9 | POST-метод создания машины | 0,8 |
| 10 | GET-метод получения машины по id | 0,5 |
| 11 | POST-метод импорта CSV (инициализация БД) | 1,3 |
| 12 | Импорт может проводиться сколько угодно раз без сбоев и дублирования данных | 0,5 |
| 13 | POST-метод поиска машин по любому набору фильтров | 1,1 |
| 14 | DTO-классы соответствует спецификации | 0,3 |
| 15 | DTO-классы имеют валидации по заданию | 0,5 |
| 16 | Имеются конвертеры DTO-Entity | 0,5 |
| 17 | Имеются JPA-сущности машины и производителя | 0,5 |
| 18 | При создании машины обработка исключения не найденного производителя | 0,3 |
| 19 | При получении любой сущности по id обработка исключения не найдена сущность | 0,3 |
| 20 | Имеются unit-тесты на все методы сервисных классов (бонус) | 2 |